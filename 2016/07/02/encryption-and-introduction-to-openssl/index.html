<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" href="/img/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Kovacs"><meta name="keywords" content="Linux,OpenSSL,CA,证书,crt"><meta name="description" content="基本加密常识和 OpenSSL 使用简介"><meta property="og:type" content="article"><meta property="og:title" content="互联网加密及 OpenSSL 介绍和简单使用"><meta property="og:url" content="https://mritd.com/2016/07/02/encryption-and-introduction-to-openssl/index.html"><meta property="og:site_name" content="Kovacs"><meta property="og:description" content="基本加密常识和 OpenSSL 使用简介"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_shenfenrenzheng1.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_shenfenrenzheng2.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_DH.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_datawanzheng.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_dirtree.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_createcapb.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_createcafiledirtree.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_createprivatekey.png"><meta property="og:image" content="https://cdn.oss.link/markdown/hexo_openssl_signedcrt.png"><meta property="article:published_time" content="2016-07-02T07:04:16.000Z"><meta property="article:modified_time" content="2016-07-02T07:04:16.000Z"><meta property="article:author" content="Kovacs"><meta property="article:tag" content="Linux"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.oss.link/markdown/hexo_openssl_shenfenrenzheng1.png"><meta name="twitter:creator" content="@kovacs_orz"><meta name="twitter:site" content="https://twitter.com/kovacs_orz"><title>互联网加密及 OpenSSL 介绍和简单使用 - Kovacs</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"mritd.com",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:80,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:"❡"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!0,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:"G-H06NPECR0Z"},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-H06NPECR0Z",(function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-H06NPECR0Z")}))</script><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Kovacs" type="application/atom+xml">
<link rel="alternate" href="/rss.xml" title="Kovacs" type="application/rss+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Kovacs</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/friends/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="互联网加密及 OpenSSL 介绍和简单使用"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Kovacs </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2016-07-02 15:04" pubdate>2016年7月2日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 25 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">互联网加密及 OpenSSL 介绍和简单使用</h1><div class="markdown-body"><h2 id="一、互联网通信安全简述"><a href="#一、互联网通信安全简述" class="headerlink" title="一、互联网通信安全简述"></a>一、互联网通信安全简述</h2><h3 id="1-1、安全问题"><a href="#1-1、安全问题" class="headerlink" title="1.1、安全问题"></a>1.1、安全问题</h3><p>随着互联网不断发展，网络安全日益重要，而在互联网上的两台主机间通讯安全成为隐患，其主要面临两大问题 : <strong>身份认证与数据安全</strong>。</p><h3 id="1-2、身份认证"><a href="#1-2、身份认证" class="headerlink" title="1.2、身份认证"></a>1.2、身份认证</h3><p>当互联网上两台从未通讯过的主机进行通讯时，比如我们第一次访问支付宝网站，我们如何确信对方主机是真实的，比如我们在浏览器中输入支付宝的地址最终到达的主机是支付宝的主机，而并非别人仿造的假的钓鱼网站？此时面临的问题就是一个 <strong>身份认证</strong> 问题，即对方要能证明其身份。</p><h3 id="1-3、数据安全"><a href="#1-3、数据安全" class="headerlink" title="1.3、数据安全"></a>1.3、数据安全</h3><p>假设已经解决了身份认证问题，那么接下来的操作如何保证数据不被窃取？比如在支付宝网站进行转账操作，如何保证密码传输过程中不会被别人窃取；此时面临的就是 <strong>数据安全</strong> 问题。</p><h2 id="二、加密算法"><a href="#二、加密算法" class="headerlink" title="二、加密算法"></a>二、加密算法</h2><h3 id="2-1、加密方式分类"><a href="#2-1、加密方式分类" class="headerlink" title="2.1、加密方式分类"></a>2.1、加密方式分类</h3><p>目前互联网上的加密算法主要分为三大类 : <strong>对称加密(双向加密)、非对称加密、公钥加密。</strong></p><h3 id="2-2、对称加密"><a href="#2-2、对称加密" class="headerlink" title="2.2、对称加密"></a>2.2、对称加密</h3><p>对称加密也称作双向加密，即 <strong>加密与解密使用同一密码</strong>，对明文使用密码加密后，对方可以通过同一密码进行反向解密，<strong>加密安全性完全依赖于加密密码。</strong>常见的加密算法有 <code>DES(56bits)</code>、<code>3DES</code>、<code>AES(128bits)</code>、<code>Blowfish</code>、<code>Twofish</code>、<code>IDEA</code>、<code>RC6</code>、<code>CAST5</code>、<code>Serpent</code>等等；此种方式加密容易遭受 <strong>字典攻击</strong>，同时解密方需要得到加密密码，中间可能涉及密码传输泄露问题；此种加密一般都是 <strong>将原文分割成固定大小的数据块，对这些块进行加密(ECB，CBC)。</strong></p><h3 id="2-3、非对称加密"><a href="#2-3、非对称加密" class="headerlink" title="2.3、非对称加密"></a>2.3、非对称加密</h3><p>非对称加密与对称加密相反，其加密解密可使用不同的密码，常见的如 <code>RSA</code>、<code>EIGmal</code>、<code>DSA</code> 等。</p><h4 id="2-3-1、单向加密"><a href="#2-3-1、单向加密" class="headerlink" title="2.3.1、单向加密"></a>2.3.1、单向加密</h4><p>在非对称加密中，有一种比较特殊的加密叫做单向加密，<strong>单向机密也称消息摘要算法，其主要目的是提取消息特征码，加密后的密文不可逆。</strong>常见的单向加密算法有 : <code>MD5</code>、<code>SHA1</code>、<code>SHA512</code>、<code>CRC-32(循环冗余校验码)</code> 等；单向加密有两个重要的特性 : <strong>定长输出、雪崩效应；</strong>定长输出可以理解为 <strong>无论消息体多大，最终输出加密后结果长度一致，雪崩效应顾名思义，即消息体的微小变化，会导致加密结果的巨大变化。</strong></p><h3 id="2-4、公钥加密"><a href="#2-4、公钥加密" class="headerlink" title="2.4、公钥加密"></a>2.4、公钥加密</h3><p>公钥加密时会有两个文件，即一个公钥一个私钥；并且公钥与私钥成对出现，其特性是 <strong>使用公钥加密的内容必须使用与其匹配的私钥解密，反之亦然。</strong></p><h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><h3 id="3-1、身份认证的解决"><a href="#3-1、身份认证的解决" class="headerlink" title="3.1、身份认证的解决"></a>3.1、身份认证的解决</h3><p>由上可知，首先我们面临的第一个问题就是身份认证问题，即 “支付宝要能证明他是支付宝”；纵观以上3中加密算法，比较适合做身份认证的就是 <strong>公钥加密</strong>，<strong>即在互联网上从未通讯过的主机想向对方证明自己的身份，只需先生成一对密钥，然后将公钥放在互联网上大家可任意获取，私钥自己保留；需要证明身份时只需用自己的私钥加密一段信息发给对方，对方若能使用其公钥解密，就能证明其身份。</strong>简单的例子如下所示，支付宝服务器先将自己的公钥放到互联网上，然后我们需要支付宝服务器证明其身份的时候，支付宝服务器先用自己的私钥加密一段文字，若我们使用互联网上的支付宝公钥能够将其解密，则就能证明此服务器是真实的</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_shenfenrenzheng1.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_shenfenrenzheng1"></p><h3 id="3-2、CA-机构"><a href="#3-2、CA-机构" class="headerlink" title="3.2、CA 机构"></a>3.2、CA 机构</h3><p>上面的做法似乎完美的解决了身份认证问题，但并非如此，这中间存在一个巨大漏洞；即 <strong>如何保证从互联网上获取的公钥就是对方的，而不是别人恶意放到互联网上的假冒公钥。</strong>此时的解决方案就是 <strong>大家找一个公认的知名机构，把公钥全部放到这个机构那，然后谁需要谁从那里下载</strong>，此时这个机构称之为 CA，CA 为每个使用者颁发一个证书，证书中包含其公钥和CA 的私钥签名，以及一些使用者信息；<strong>同时证书具有级联信任关系，即 我们信任了一家 CA 的根证书，那么由其颁发的其他证书将都被信任，类似于一棵树的结构，一旦我们信任了根节点那么以下所有子节点将全部被信任。</strong></p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_shenfenrenzheng2.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_shenfenrenzheng2"></p><h3 id="3-3、数据加密的解决"><a href="#3-3、数据加密的解决" class="headerlink" title="3.3、数据加密的解决"></a>3.3、数据加密的解决</h3><p>当我们使用公钥加密和 CA 机制解决了身份认证以后，接下来的问题就是数据传输过程中的加密问题；既然是传输数据，那么数据内容肯定需要双向加密才可以被接收方解密读取，但是很大的问题是 <strong>双向加密时，解密方需要知道解密密码；</strong>而将密码在互联网上传输明显是不明智的，此时出现了另一种解决方案，即 <strong>密钥交换算法</strong>，专门用于在互联网上传输密钥信息。</p><h4 id="3-3-1、Diffie-Hellman-算法"><a href="#3-3-1、Diffie-Hellman-算法" class="headerlink" title="3.3.1、Diffie-Hellman 算法"></a>3.3.1、Diffie-Hellman 算法</h4><p>Diffie–Hellman 是著名的密钥交换算法，其基本原理如下：</p><ul><li>首先两台计算机互相通讯，并约定选取一个大素数 g</li><li>然后两台计算机再协商一个计算数 p</li><li>接下来每台计算机随机选定一个随机数，此随机数并不会发给对方(x、y)</li><li>通讯时，A 计算机计算 <code>g^x % p</code> 发给 B 计算机</li><li>接下来同样 B 计算机计算 <code>g^y % p</code> 发给 A 计算机</li><li>B 计算机拿到 <code>g^x % p</code> 后再进行 <code>(g^x % p)^y</code> 即最终结果为 <code>g^xy % p</code></li><li>同样 A 计算机拿到 <code>g^y % p</code> 后再进行 <code>(g^y % p)^x</code> 即最终结果为 <code>g^xy % p</code></li><li>此时两台计算机结果将一致，接下来传送的数据便以此结果为密码进行加密即可</li></ul><p><strong>此过程中双方都保留了私有的 x、y 随机数，x、y 并未在互联网上传输，所以是安全的，并且由离散数学原理 x、y 被推测的可能性很小，以当前计算机性能基本不可能推测(不要提超级计算机，黑客没那个资源)。</strong></p><h4 id="3-3-2、Diffie-Hellman-算法示意图"><a href="#3-3-2、Diffie-Hellman-算法示意图" class="headerlink" title="3.3.2、Diffie-Hellman 算法示意图"></a>3.3.2、Diffie-Hellman 算法示意图</h4><p>Diffie-Hellman 算法示意图如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_DH.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_DH"></p><h3 id="3-4、数据完整性"><a href="#3-4、数据完整性" class="headerlink" title="3.4、数据完整性"></a>3.4、数据完整性</h3><p>以上部分已经实现了身份校验以及数据加密操作，接下来我们需要保证数据的完整性，对于完整性最好的应用就是采用单向加密即消息摘要算法，提取数据的特征码；<strong>简单地说就是每发送一段数据，就对发送的数据做一次数据特征提取，然后将特征码一并发送，接收方接收到数据并解密后可对其使用同样的算法进行特征码提取比对，如果计算结果不一致则证明数据被篡改，直接丢弃即可。</strong></p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_datawanzheng.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_datawanzheng"></p><h2 id="四、OpenSSL-使用"><a href="#四、OpenSSL-使用" class="headerlink" title="四、OpenSSL 使用"></a>四、OpenSSL 使用</h2><h3 id="4-1、OpenSSL-简介"><a href="#4-1、OpenSSL-简介" class="headerlink" title="4.1、OpenSSL 简介"></a>4.1、OpenSSL 简介</h3><p>OpenSSL 是一组加密套件，其提供了功能强大的加密解密功能，以及证书相关的操作工具，OpenSSL 分为三大部分 : <code>libcrypto</code> 通用功能的加密库、<code>libssl</code> 用于实现TLS&#x2F;SSL的功能 和 <code>openssl</code> 多功能命令工具；而一般 OpenSSL 使用指的就是多功能命令行工具的使用。</p><p>OpenSSL 有许多子命令，可通过 <code>openssl ?</code> 查看其支持子命令和加密算法等信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh">Standard commands<br>asn1parse         ca                ciphers           cms<br>crl               crl2pkcs7         dgst              dh<br>dhparam           dsa               dsaparam          ec<br>ecparam           enc               engine            errstr<br>gendh             gendsa            genpkey           genrsa<br>nseq              ocsp              passwd            pkcs12<br>pkcs7             pkcs8             pkey              pkeyparam<br>pkeyutl           prime             rand              req<br>rsa               rsautl            s_client          s_server<br>s_time            sess_id           smime             speed<br>spkac             srp               ts                verify<br>version           x509<br><br>Message Digest commands (see the `dgst<span class="hljs-string">&#x27; command for more details)</span><br><span class="hljs-string">md4               md5               rmd160            sha</span><br><span class="hljs-string">sha1</span><br><span class="hljs-string"></span><br><span class="hljs-string">Cipher commands (see the `enc&#x27;</span> <span class="hljs-built_in">command</span> <span class="hljs-keyword">for</span> more details)<br>aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb<br>aes-256-cbc       aes-256-ecb       <span class="hljs-built_in">base64</span>            bf<br>bf-cbc            bf-cfb            bf-ecb            bf-ofb<br>camellia-128-cbc  camellia-128-ecb  camellia-192-cbc  camellia-192-ecb<br>camellia-256-cbc  camellia-256-ecb  cast              cast-cbc<br>cast5-cbc         cast5-cfb         cast5-ecb         cast5-ofb<br>des               des-cbc           des-cfb           des-ecb<br>des-ede           des-ede-cbc       des-ede-cfb       des-ede-ofb<br>des-ede3          des-ede3-cbc      des-ede3-cfb      des-ede3-ofb<br>des-ofb           des3              desx              rc2<br>rc2-40-cbc        rc2-64-cbc        rc2-cbc           rc2-cfb<br>rc2-ecb           rc2-ofb           rc4               rc4-40<br>seed              seed-cbc          seed-cfb          seed-ecb<br>seed-ofb<br></code></pre></td></tr></table></figure><h3 id="4-2、OpenSSL-实现加解密"><a href="#4-2、OpenSSL-实现加解密" class="headerlink" title="4.2、OpenSSL 实现加解密"></a>4.2、OpenSSL 实现加解密</h3><h4 id="4-2-1、加密操作"><a href="#4-2-1、加密操作" class="headerlink" title="4.2.1、加密操作"></a>4.2.1、加密操作</h4><p>OpenSSL 使用子命令 <code>enc</code> 实现加密，命令格式如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl enc -算法 -salt -a -salt -<span class="hljs-keyword">in</span> 输入文件 -out 输出文件 -k passwd<br></code></pre></td></tr></table></figure><p>如下为加密一个文件示例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl enc -aes-256-ecb  -a -salt -<span class="hljs-keyword">in</span> /etc/profile -out ~/test -k test123<br></code></pre></td></tr></table></figure><p><code>-a</code> 选项用于将加密后内容以 base64 格式输出，加密后内容如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">U2FsdGVkX1/tVWQ7cGR5rTLU9Phnx7csis12ukuGpZTWx7sDiJ8Qdb4Jn8hvShnW<br>7gPouyOwJlKufoDHXT2hqOnw/i8Rf5QisLc+EOXgUWDFun3AqHte6YmNbelDFchu<br>hDsph4Vq7TNBmZ/C1LHSCnMoA39qHBWxyrIstpOWs5TWkdPjDgEVZkIXNiWIwoRF<br>CDVv7AuZXO9qF3sMb4fLWPF9cM7FkbvGkkhzBJZ0dAdq8DetKaZyjOX4UfeWPSav<br>U61t9s7hlmjEPmXpUSSfnO8/7u0B/EEnujpkwyNZXbQBcQ9QFDh7x1vdzQIAuMRw<br>0SLsVm1OSOifvMOpOAJCmvhExrKsznWgQlQabLOWsr29yrs0YBuwSl6oUSf8Qx1S<br>3z/GC7l13zzmHwXJTgPRe0WzdLYsy6GMj2/0DveLvcXT/cXGid69tzIf4JaczIEX<br>zSS4N12C3CFS/60poXZmiwoNsC3n6ESBf3dZum6LKA9sNPdxveb/RTZ4KYl/iw9S<br>NgAqNGa9Yp1xdyl2NBaruvDxVAGbwC+rGn9UjbIYbEdT7ZjKPjJ6BP8yzwv6jnOU<br>3E58UVIuIEVWJY3kF77+Vk99JuQepFRGX9sHYdafQR7AISiS88eipn6qkMMDmrkT<br>kwZtebWyhvmWTZABOa7tckzzYxJ/Ke1jkBudasUJr9RUEiNNmSASdRr0dlZvM/tS<br>COuPeNo8ZU7ad/yd/OpvPKShn9Hh9oXCKSB4vl/DQVefVXWAaTp49FFAGFrQThiQ<br>rAwHwrJ/N2ab0Do0iArctNTqz5u7MtEHwVtFsV45YJfAGQRwTg06Y6qKjhgWmBjX<br>EGNGbP7c0A1SiI/g8maKl3ciTwWPWXCcpf14MFcYBvjpA7EVYSYTh7hSxzUtY0gk<br>l3EUVrqnY0M8u+0LBgAcrA==<br></code></pre></td></tr></table></figure><h4 id="4-2-2、解密操作"><a href="#4-2-2、解密操作" class="headerlink" title="4.2.2、解密操作"></a>4.2.2、解密操作</h4><p>解密操作与加密基本相同，只不过需要加上 <code>-d</code> 选项，代表解密，命令格式如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl enc -算法 -salt -d -a -<span class="hljs-keyword">in</span> 输入文件 -out 输出文件 -k passwd<br></code></pre></td></tr></table></figure><p>如下为解密一个文件的示例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl enc -aes-256-ecb -salt -d -a -<span class="hljs-keyword">in</span> <span class="hljs-built_in">test</span> -out test1 -k test123<br></code></pre></td></tr></table></figure><p>解密后文件即为原来的 <code>/etc/profile</code> 文件内容</p><h3 id="4-3、OpenSSL-创建-CA"><a href="#4-3、OpenSSL-创建-CA" class="headerlink" title="4.3、OpenSSL 创建 CA"></a>4.3、OpenSSL 创建 CA</h3><p>关于 CA 证书本文并未做过多解释，限于篇幅，完全解释完太多，以下为一篇写的比较好的文章 <a target="_blank" rel="noopener" href="http://seanlook.com/2015/01/15/openssl-certificate-encryption/">点这里</a>；下面主要介绍 OpenSSL 工具建立私有 CA。</p><h4 id="4-3-1、OpenSSL-CA-相关配置"><a href="#4-3-1、OpenSSL-CA-相关配置" class="headerlink" title="4.3.1、OpenSSL CA 相关配置"></a>4.3.1、OpenSSL CA 相关配置</h4><p>默认的 Ubuntu 下 OpenSSL 的配置文件位于 <code>/etc/ssl/openssl.cnf</code>，CentOS 位于 <code>/etc/pki/tls/openssl.cnf</code>，我们只需要关注如下部分，关于具体配置含义 Google 之。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">####################################################################</span><br>[ ca ]<br>default_ca      = CA_default            <span class="hljs-comment"># The default ca section</span><br><br><span class="hljs-comment">####################################################################</span><br>[ CA_default ]<br><br><span class="hljs-built_in">dir</span>             = ./demoCA              <span class="hljs-comment"># Where everything is kept</span><br>certs           = <span class="hljs-variable">$dir</span>/certs            <span class="hljs-comment"># Where the issued certs are kept</span><br>crl_dir         = <span class="hljs-variable">$dir</span>/crl              <span class="hljs-comment"># Where the issued crl are kept</span><br>database        = <span class="hljs-variable">$dir</span>/index.txt        <span class="hljs-comment"># database index file.</span><br><span class="hljs-comment">#unique_subject = no                    # Set to &#x27;no&#x27; to allow creation of</span><br>                                        <span class="hljs-comment"># several ctificates with same subject.</span><br>new_certs_dir   = <span class="hljs-variable">$dir</span>/newcerts         <span class="hljs-comment"># default place for new certs.</span><br><br>certificate     = <span class="hljs-variable">$dir</span>/cacert.pem       <span class="hljs-comment"># The CA certificate</span><br>serial          = <span class="hljs-variable">$dir</span>/serial           <span class="hljs-comment"># The current serial number</span><br>crlnumber       = <span class="hljs-variable">$dir</span>/crlnumber        <span class="hljs-comment"># the current crl number</span><br>                                        <span class="hljs-comment"># must be commented out to leave a V1 CRL</span><br>crl             = <span class="hljs-variable">$dir</span>/crl.pem          <span class="hljs-comment"># The current CRL</span><br>private_key     = <span class="hljs-variable">$dir</span>/private/cakey.pem<span class="hljs-comment"># The private key</span><br>RANDFILE        = <span class="hljs-variable">$dir</span>/private/.rand    <span class="hljs-comment"># private random number file</span><br><br>x509_extensions = usr_cert              <span class="hljs-comment"># The extentions to add to the cert</span><br><br><span class="hljs-comment"># Comment out the following two lines for the &quot;traditional&quot;</span><br><span class="hljs-comment"># (and highly broken) format.</span><br>name_opt        = ca_default            <span class="hljs-comment"># Subject Name options</span><br>cert_opt        = ca_default            <span class="hljs-comment"># Certificate field options</span><br><br><span class="hljs-comment"># Extension copying option: use with caution.</span><br><span class="hljs-comment"># copy_extensions = copy</span><br><br><span class="hljs-comment"># Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs</span><br><span class="hljs-comment"># so this is commented out by default to leave a V1 CRL.</span><br><span class="hljs-comment"># crlnumber must also be commented out to leave a V1 CRL.</span><br><span class="hljs-comment"># crl_extensions        = crl_ext</span><br><br>default_days    = 365                   <span class="hljs-comment"># how long to certify for</span><br>default_crl_days= 30                    <span class="hljs-comment"># how long before next CRL</span><br>default_md      = default               <span class="hljs-comment"># use public key default MD</span><br>preserve        = no                    <span class="hljs-comment"># keep passed DN ordering</span><br><br><span class="hljs-comment"># A few difference way of specifying how similar the request should look</span><br><span class="hljs-comment"># For type CA, the listed attributes must be the same, and the optional</span><br><span class="hljs-comment"># and supplied fields are just that :-)</span><br>policy          = policy_match<br><br><span class="hljs-comment"># For the CA policy</span><br>[ policy_match ]<br>countryName             = match<br>stateOrProvinceName     = match<br>organizationName       = match<br>organizationalUnitName  = optional<br>commonName              = supplied<br>emailAddress            = optional<br></code></pre></td></tr></table></figure><h4 id="4-3-2、生成密钥对"><a href="#4-3-2、生成密钥对" class="headerlink" title="4.3.2、生成密钥对"></a>4.3.2、生成密钥对</h4><p>由配置文件可知，OpenSSL 默认的工作目录在 <code>./demoCA</code> 下，所以需要先创建 CA 所需相关目录，执行 <code>mkdir -p demoCA/&#123;private,certs,crl,newcerts&#125;</code>，目录结构如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_dirtree.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_dirtree"></p><p>然后生成一个私钥(<strong>公钥其实是从私钥中提取的，所以创建私钥就可以从中提取出公钥</strong>)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 使用 () 开启子 shell 执行，同时设置掩码</span><br>(<span class="hljs-built_in">umask</span> 077; openssl genrsa -out demoCA/private/cakey.pem 2048)<br><span class="hljs-comment"># 如果想查看公钥可执行以下命令(非必须)</span><br>openssl rsa -<span class="hljs-keyword">in</span> demoCA/private/cakey.pem -pubout<br></code></pre></td></tr></table></figure><h4 id="4-3-3、生成自签证书"><a href="#4-3-3、生成自签证书" class="headerlink" title="4.3.3、生成自签证书"></a>4.3.3、生成自签证书</h4><p>作为根 CA，可以生成一个自签名的证书，来标明自己的身份，签名方法如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl req -new -x509 -key demoCA/private/cakey.pem -days 3655 -out demoCA/cacert.pem<br></code></pre></td></tr></table></figure><p>然后输入相关信息，注意不要乱输入，其中 <code>Common Name</code> 一般为使用者域名，这里暂时填写的是 IP，截图如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_createcapb.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_createcapb"></p><p><strong>最后要创建用于签名证书的相关文件，</strong>执行 <code>touch demoCA/&#123;index.txt,serial,crlnumber&#125;</code> 创建所需文件，执行 <code>echo &quot;01&quot; &gt; demoCA/serial</code> 初始化序列号，最终文件目录结构如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_createcafiledirtree.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_createcafiledirtree"></p><h3 id="4-4、OpneSSL-申请证书"><a href="#4-4、OpneSSL-申请证书" class="headerlink" title="4.4、OpneSSL 申请证书"></a>4.4、OpneSSL 申请证书</h3><p>同样，先生成一对密钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 创建目录</span><br><span class="hljs-built_in">mkdir</span> mycrt<br><span class="hljs-comment"># 生成公钥 扩展名随便取</span><br>openssl genrsa -out mritd.key 2048<br><span class="hljs-comment"># 提取公钥</span><br>openssl rsa -<span class="hljs-keyword">in</span> mritd.key -pubout &gt; mritd.public.key<br></code></pre></td></tr></table></figure><p><strong>接下来要申请一个证书签署请求，信息要保证与 CA 创建时一致(具体可调整 openssl.cnf 配置文件)，密码直接回车默认为空密码</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl req -new -key mritd.key -out mritd.csr<br></code></pre></td></tr></table></figure><p>截图如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_createprivatekey.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_createprivatekey"></p><p>最后使用 CA 进行签署即可(注意，要回到 <code>demoCA</code> 上一级目录)，提示是否确认全部 y 即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl ca -<span class="hljs-keyword">in</span> mycrt/mritd.csr -out mycrt/mritd.crt -days 3655<br></code></pre></td></tr></table></figure><p>截图如下</p><p><img src="https://cdn.oss.link/markdown/hexo_openssl_signedcrt.png" srcset="/img/loading.gif" lazyload alt="hexo_openssl_signedcrt"></p><p><strong>最终生成的 <code>mritd.crt</code> 即为可用的证书</strong></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/linux/" class="category-chain-item">Linux</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/linux/" class="print-no-link">#Linux</a></div></div><div class="license-box my-3"><div class="license-title"><div>互联网加密及 OpenSSL 介绍和简单使用</div><div>https://mritd.com/2016/07/02/encryption-and-introduction-to-openssl/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Kovacs</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2016年7月2日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2016/07/03/harbor-enterprise-docker-registry-part3/" title="Harbor 企业级 Docker Registry HTTPS配置"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Harbor 企业级 Docker Registry HTTPS配置</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2016/06/27/harbor-enterprise-docker-registry-part1/" title="Harbor 企业级 Docker Registry 初试"><span class="hidden-mobile">Harbor 企业级 Docker Registry 初试</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config=function(){this.page.url="https://mritd.com/2016/07/02/encryption-and-introduction-to-openssl/",this.page.identifier="/2016/07/02/encryption-and-introduction-to-openssl/"};Fluid.utils.loadComments("#disqus_thread",(function(){var t=document,e=t.createElement("script");e.src="//bleem.disqus.com/embed.js",e.setAttribute("data-timestamp",new Date),(t.head||t.body).appendChild(e)}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-docker"></i> <a href="https://bandwagonhost.com/aff.php?aff=61367" target="_blank" rel="nofollow noopener"><span>BandwagonHost</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!0,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>